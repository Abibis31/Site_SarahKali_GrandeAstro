<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sarah Kali ‚Ä¢ Tarot, Astrologia e Numerologia</title>
    <link rel="stylesheet" href="css/style.css">
    
    <!-- Fontes M√≠sticas -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@300;400;500;600&family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Playfair+Display:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Favicon M√≠stico -->
    <link rel="icon" href="assets/icons/crystal-ball.ico" type="image/x-icon">
</head>
<body>
    <!-- Header Elegante -->
    <header class="header">
        <nav class="navbar">
            <div class="nav-brand">
                <h2>Sarah Kali</h2>
            </div>
            <ul class="nav-menu">
                <li><a href="#home">In√≠cio</a></li>
                <li><a href="#servicos">Servi√ßos</a></li>
                <li><a href="#sobre">Sobre</a></li>
                <li><a href="#contato">Contato</a></li>
            </ul>
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </nav>
    </header>

    <!-- Hero Section -->
    <section id="home" class="hero">
        <div class="hero-content">
            <h1 data-aos="fade-up">Sarah Kali</h1>
            <p data-aos="fade-up" data-aos-delay="200">Desvendando os mist√©rios do universo atrav√©s do Tarot, Astrologia e Numerologia</p>
            <div class="hero-buttons" data-aos="fade-up" data-aos-delay="400">
                <a href="#servicos" class="btn-primary">Conhecer Servi√ßos</a>
                <a href="#contato" class="btn-secondary">Agendar Consulta</a>
            </div>
        </div>
        <div class="hero-image" data-aos="fade-left" data-aos-delay="600">
            <img src="/assets/Santa-Sara-Kali.png" alt="Sarah Kali" class="hero-img">
        </div>
    </section>

    <!-- Servi√ßos -->
    <section id="servicos" class="services">
        <div class="container">
            <h2 data-aos="fade-up">Servi√ßos Espirituais</h2>
            <p class="section-subtitle" data-aos="fade-up" data-aos-delay="200">T√©cnicas ancestrais para guiar seu caminho</p>
            
            <div class="services-grid">
                <div class="service-card" data-aos="fade-up" data-aos-delay="400">
                    <div class="card-icon">‚ú®</div>
                    <h3>Consulta de Tarot</h3>
                    <p>Revela√ß√µes precisas atrav√©s das cartas para iluminar seu caminho e oferecer orienta√ß√£o transformadora.</p>
                    <ul>
                        <li>Leitura completa de 78 cartas</li>
                        <li>An√°lise de situa√ß√£o atual</li>
                        <li>Previs√µes e conselhos</li>
                        <li>Dura√ß√£o: 60 minutos</li>
                    </ul>
                    <a href="#" class="card-btn">Agendar Sess√£o</a>
                </div>

                <div class="service-card" data-aos="fade-up" data-aos-delay="600">
                    <div class="card-icon">üí´</div>
                    <h3>Mapa Astral</h3>
                    <p>Explore as energias c√≥smicas que influenciam sua vida pessoal, profissional e relacional.</p>
                    <ul>
                        <li>Mapa astral completo</li>
                        <li>An√°lise de signos e casas</li>
                        <li>Previs√µes astrol√≥gicas</li>
                        <li>Relat√≥rio detalhado</li>
                    </ul>
                    <a href="#" class="card-btn">Explorar Mapa</a>
                </div>

                <div class="service-card" data-aos="fade-up" data-aos-delay="800">
                    <div class="card-icon">üìù</div>
                    <h3>Numerologia</h3>
                    <p>Descubra os segredos ocultos nos n√∫meros do seu nome e data de nascimento.</p>
                    <ul>
                        <li>An√°lise do n√∫mero de vida</li>
                        <li>N√∫mero de express√£o</li>
                        <li>Ano pessoal e mensal</li>
                        <li>Relat√≥rio numerol√≥gico</li>
                    </ul>
                    <a href="#" class="card-btn">Calcular N√∫meros</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Sobre -->
    <section id="sobre" class="about">
        <div class="container">
            <div class="about-content">
                <div class="about-text" data-aos="fade-right">
                    <h2>Sarah Kali</h2>
                    <p class="about-subtitle">Mestre em Ci√™ncias Ocultas h√° mais de 15 anos</p>
                    <p>Com vasta experi√™ncia em Tarot, Astrologia e Numerologia, dedico minha vida a ajudar pessoas a encontrarem clareza e prop√≥sito atrav√©s das artes divinat√≥rias.</p>
                    <p>Minha abordagem combina conhecimento tradicional com intui√ß√£o desenvolvida ao longo de anos de pr√°tica e estudos profundos.</p>
                    <div class="about-stats">
                        <div class="stat">
                            <span class="stat-number">5.000+</span>
                            <span class="stat-label">Clientes Atendidos</span>
                        </div>
                        <div class="stat">
                            <span class="stat-number">15+</span>
                            <span class="stat-label">Anos de Experi√™ncia</span>
                        </div>
                        <div class="stat">
                            <span class="stat-number">98%</span>
                            <span class="stat-label">Satisfa√ß√£o</span>
                        </div>
                    </div>
                </div>
                <div class="about-image" data-aos="fade-left">
                    <img src="assets/sarah-about.jpg" alt="Sarah Kali">
                </div>
            </div>
        </div>
    </section>

    <!-- Depoimentos -->
    <section class="testimonials">
        <div class="container">
            <h2 data-aos="fade-up">O que dizem meus clientes</h2>
            <div class="testimonials-grid">
                <div class="testimonial-card" data-aos="fade-up">
                    <div class="testimonial-text">
                        "A consulta com Sarah mudou minha perspectiva sobre v√°rios aspectos da vida. As orienta√ß√µes foram precisas e transformadoras."
                    </div>
                    <div class="testimonial-author">
                        <strong>Maria Silva</strong>
                        <span>Consulta de Tarot</span>
                    </div>
                </div>
                <div class="testimonial-card" data-aos="fade-up" data-aos-delay="200">
                    <div class="testimonial-text">
                        "O mapa astral revelou aspectos da minha personalidade que eu nem imaginava. Muito esclarecedor!"
                    </div>
                    <div class="testimonial-author">
                        <strong>Jo√£o Santos</strong>
                        <span>Mapa Astral</span>
                    </div>
                </div>
                <div class="testimonial-card" data-aos="fade-up" data-aos-delay="400">
                    <div class="testimonial-text">
                        "A numerologia me ajudou a entender melhor meus talentos e desafios. Recomendo muito!"
                    </div>
                    <div class="testimonial-author">
                        <strong>Ana Costa</strong>
                        <span>Numerologia</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contato -->
    <section id="contato" class="contact">
        <div class="container">
            <h2 data-aos="fade-up">Entre em Contato</h2>
            <div class="contact-content">
                <div class="contact-info" data-aos="fade-right">
                    <h3>Agende sua consulta</h3>
                    <div class="contact-item">
                        <strong>üìß Email</strong>
                        <p>contato@sarahkali.com</p>
                    </div>
                    <div class="contact-item">
                        <strong>üì± WhatsApp</strong>
                        <p>(11) 99999-9999</p>
                    </div>
                    <div class="contact-item">
                        <strong>üïí Hor√°rios</strong>
                        <p>Segunda a S√°bado: 9h √†s 18h</p>
                    </div>
                </div>
                <form class="contact-form" data-aos="fade-left">
                    <input type="text" placeholder="Seu nome" required>
                    <input type="email" placeholder="Seu email" required>
                    <select required>
                        <option value="">Selecione o servi√ßo</option>
                        <option value="tarot">Consulta de Tarot</option>
                        <option value="astrologia">Mapa Astral</option>
                        <option value="numerologia">Numerologia</option>
                    </select>
                    <textarea placeholder="Sua mensagem" rows="5"></textarea>
                    <button type="submit" class="btn-primary">Enviar Mensagem</button>
                </form>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <!-- Bot√£o WhatsApp Flutuante -->
        <a 
            href="https://wa.me/5511999999999?text=Ol√°!%20Gostaria%20de%20agendar%20uma%20consulta%20com%20Sarah%20Kali" 
            class="whatsapp-float" 
            target="_blank" 
            rel="noopener noreferrer"
            aria-label="Fale conosco no WhatsApp"
        >
            <i class="whatsapp-icon fab fa-whatsapp"></i>
            <div class="whatsapp-tooltip">
                Agende sua consulta
            </div>
        </a>
        
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <h3>Sarah Kali</h3>
                    <p>Guiando sua jornada espiritual desde 2008</p>
                </div>
                <div class="footer-links">
                    <a href="#">Pol√≠tica de Privacidade</a>
                    <a href="#">Termos de Servi√ßo</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Sarah Kali. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- ===== CHAT DA SARAH KALI ===== -->
    <!-- Bot√£o do Chat Flutuante -->
    <button class="chat-float" id="chatFloat">
        <div class="chat-icon">üîÆ</div>
        <div class="chat-tooltip">Fale com a Sarah</div>
    </button>

    <!-- Modal do Chat -->
    <div class="chat-modal" id="chatModal">
        <div class="chat-header">
            <div class="chat-header-content">
                <div class="chat-avatar">‚ú®</div>
                <div class="chat-title">
                    <h4>Sarah Kali</h4>
                    <span class="chat-status">Online ‚Ä¢ Pronta para ajudar</span>
                </div>
            </div>
            <button class="chat-close" id="chatClose">√ó</button>
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <div class="message assistant">
                <div class="message-content">
                    Ol√°! Eu sou Sarah Kali. Como posso ajud√°-lo hoje em sua jornada espiritual? 
                    Estou aqui para orientar sobre tarot, astrologia e numerologia. ‚ú®
                </div>
            </div>
        </div>
        
        <!-- ‚úÖ √ÅREA DE UPLOAD DE COMPROVANTE -->
        <div class="chat-upload-container" id="uploadContainer" style="display: none;">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">üìé</div>
                <div class="upload-text">
                    <h4>Enviar Comprovante PIX</h4>
                    <p>Arraste ou clique para enviar comprovante (JPG, PNG, PDF)</p>
                </div>
                <input type="file" id="fileInput" class="file-input" accept=".jpg,.jpeg,.png,.pdf,.gif,.webp">
                <button class="upload-btn" id="uploadBtn">Selecionar Arquivo</button>
            </div>
            
            <div class="file-preview" id="filePreview">
                <div class="file-info">
                    <div class="file-icon">üìÑ</div>
                    <div class="file-details">
                        <div class="file-name" id="fileName">arquivo.jpg</div>
                        <div class="file-size" id="fileSize">0 KB</div>
                    </div>
                    <button class="file-remove" id="fileRemove">√ó</button>
                </div>
                <div class="upload-progress">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                <div class="upload-status">
                    <span id="uploadStatus">Pronto para enviar</span>
                    <span id="uploadPercentage">0%</span>
                </div>
                <button class="upload-btn" id="sendFileBtn" style="width: 100%; margin-top: 1rem;">
                    üì§ Enviar Comprovante
                </button>
            </div>
        </div>
        
        <div class="chat-input-container">
            <form class="chat-form" id="chatForm">
                <input 
                    type="text" 
                    id="chatInput"
                    placeholder="Digite sua pergunta sobre espiritualidade..."
                    maxlength="500"
                >
                <button type="submit" class="chat-send">
                    <span>Enviar</span>
                    <div class="send-icon">‚û§</div>
                </button>
            </form>
            <div class="chat-suggestions">
                <button class="suggestion-btn" data-question="Como funciona uma consulta de tarot?">
                    üìö Consulta de Tarot
                </button>
                <button class="suggestion-btn" data-question="O que inclui um mapa astral completo?">
                    üí´ Mapa Astral
                </button>
                <button class="suggestion-btn" data-question="Como agendar uma consulta particular?">
                    ‚ö° Agendar Consulta
                </button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        // ===== ANIMA√á√ïES GERAIS =====
        AOS.init({
            duration: 1000,
            once: true,
            offset: 100
        });

        // Mobile Menu
        const hamburger = document.querySelector('.hamburger');
        const navMenu = document.querySelector('.nav-menu');

        hamburger.addEventListener('click', () => {
            hamburger.classList.toggle('active');
            navMenu.classList.toggle('active');
        });

        // ===== SISTEMA DE CHAT E UPLOAD =====
        const chatFloat = document.getElementById('chatFloat');
        const chatModal = document.getElementById('chatModal');
        const chatClose = document.getElementById('chatClose');
        const chatForm = document.getElementById('chatForm');
        const chatInput = document.getElementById('chatInput');
        const chatMessages = document.getElementById('chatMessages');
        const suggestionBtns = document.querySelectorAll('.suggestion-btn');
        
        // ‚úÖ ELEMENTOS DO UPLOAD
        const uploadContainer = document.getElementById('uploadContainer');
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const uploadBtn = document.getElementById('uploadBtn');
        const filePreview = document.getElementById('filePreview');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const fileRemove = document.getElementById('fileRemove');
        const progressBar = document.getElementById('progressBar');
        const uploadStatus = document.getElementById('uploadStatus');
        const uploadPercentage = document.getElementById('uploadPercentage');
        const sendFileBtn = document.getElementById('sendFileBtn');

        let isLoading = false;
        let lastMessageTime = 0;
        let currentFile = null;

        // ‚úÖ HIST√ìRICO DE MENSAGENS
        let chatHistory = [
            {
                role: 'assistant',
                content: 'Ol√°! Eu sou Sarah Kali. Como posso ajud√°-lo hoje em sua jornada espiritual? Estou aqui para orientar sobre tarot, astrologia e numerologia. ‚ú®'
            }
        ];

        // ‚úÖ SESSION ID √öNICO
        const sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);

        // ‚úÖ FUN√á√ÉO PARA RENDERIZAR TODO O HIST√ìRICO
        function renderChatHistory() {
            chatMessages.innerHTML = '';
            chatHistory.forEach(msg => {
                if (msg.role === 'comprovante') {
                    // Renderizar mensagem de comprovante
                    const comprovanteData = JSON.parse(msg.content);
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message comprovante';
                    messageDiv.innerHTML = `
                        <div class="message-content">
                            <div class="comprovante-info">
                                <div class="comprovante-icon">üìé</div>
                                <div class="comprovante-text">
                                    <h5>Comprovante Enviado</h5>
                                    <p>${comprovanteData.originalName} ‚Ä¢ ${formatFileSize(comprovanteData.size)}</p>
                                </div>
                            </div>
                            <div class="comprovante-actions">
                                <a href="${comprovanteData.url}" target="_blank" class="comprovante-btn">Ver Arquivo</a>
                                <button class="comprovante-btn" onclick="downloadFile('${comprovanteData.url}', '${comprovanteData.originalName}')">Download</button>
                            </div>
                        </div>
                    `;
                    chatMessages.appendChild(messageDiv);
                } else {
                    // Renderizar mensagem normal
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `message ${msg.role}`;
                    messageDiv.innerHTML = `<div class="message-content">${msg.content}</div>`;
                    chatMessages.appendChild(messageDiv);
                }
            });
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // ‚úÖ FUN√á√ÉO PARA FORMATAR TAMANHO DO ARQUIVO
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // ‚úÖ FUN√á√ÉO PARA DOWNLOAD DE ARQUIVO
        function downloadFile(url, filename) {
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // ‚úÖ INICIALIZAR CHAT COM HIST√ìRICO
        renderChatHistory();

        // Abrir/Fechar Modal
        chatFloat.addEventListener('click', () => {
            chatModal.classList.add('active');
            chatFloat.style.display = 'none';
            setTimeout(() => chatInput.focus(), 300);
        });

        chatClose.addEventListener('click', () => {
            chatModal.classList.remove('active');
            chatFloat.style.display = 'flex';
        });

        // Fechar ao clicar fora
        document.addEventListener('click', (e) => {
            if (!chatModal.contains(e.target) && !chatFloat.contains(e.target) && chatModal.classList.contains('active')) {
                chatModal.classList.remove('active');
                chatFloat.style.display = 'flex';
            }
        });

        // ‚úÖ SISTEMA DE UPLOAD DE ARQUIVOS
        uploadBtn.addEventListener('click', () => {
            fileInput.click();
        });

        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });

        // Drag and Drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileSelect(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileSelect(e.target.files[0]);
            }
        });

        fileRemove.addEventListener('click', () => {
            resetFileUpload();
        });

        // ‚úÖ PROCESSAR SELE√á√ÉO DE ARQUIVO
        function handleFileSelect(file) {
            // Validar tipo de arquivo
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'application/pdf', 'image/webp'];
            if (!allowedTypes.includes(file.type)) {
                alert('Tipo de arquivo n√£o permitido. Use JPG, PNG, GIF, PDF ou WEBP.');
                return;
            }

            // Validar tamanho (10MB m√°ximo)
            if (file.size > 10 * 1024 * 1024) {
                alert('Arquivo muito grande. O tamanho m√°ximo √© 10MB.');
                return;
            }

            currentFile = file;
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            filePreview.classList.add('active');
            uploadStatus.textContent = 'Pronto para enviar';
            uploadPercentage.textContent = '0%';
            progressBar.style.width = '0%';
        }

        // ‚úÖ RESETAR UPLOAD
        function resetFileUpload() {
            currentFile = null;
            fileInput.value = '';
            filePreview.classList.remove('active');
            uploadStatus.textContent = 'Pronto para enviar';
            uploadPercentage.textContent = '0%';
            progressBar.style.width = '0%';
        }

        // ‚úÖ ENVIAR ARQUIVO PARA O SERVIDOR
        sendFileBtn.addEventListener('click', async () => {
            if (!currentFile) {
                alert('Por favor, selecione um arquivo primeiro.');
                return;
            }

            const formData = new FormData();
            formData.append('comprovante', currentFile);
            formData.append('sessionId', sessionId);
            formData.append('servico', 'pendente'); // Ser√° atualizado quando o servi√ßo for escolhido

            try {
                sendFileBtn.disabled = true;
                uploadStatus.textContent = 'Enviando...';

                const xhr = new XMLHttpRequest();
                
                xhr.upload.addEventListener('progress', (e) => {
                    if (e.lengthComputable) {
                        const percentComplete = (e.loaded / e.total) * 100;
                        progressBar.style.width = percentComplete + '%';
                        uploadPercentage.textContent = Math.round(percentComplete) + '%';
                    }
                });

                xhr.addEventListener('load', () => {
                    if (xhr.status === 200) {
                        const response = JSON.parse(xhr.responseText);
                        if (response.success) {
                            uploadStatus.textContent = 'Enviado com sucesso! ‚úÖ';
                            
                            // ‚úÖ ADICIONAR COMPROVANTE AO HIST√ìRICO
                            chatHistory.push({
                                role: 'comprovante',
                                content: JSON.stringify({
                                    type: 'comprovante',
                                    fileName: response.file.name,
                                    originalName: response.file.name,
                                    mimeType: response.file.type,
                                    size: response.file.size,
                                    servico: 'pendente',
                                    timestamp: new Date().toISOString(),
                                    url: response.file.url
                                })
                            });
                            
                            renderChatHistory();
                            
                            // ‚úÖ ADICIONAR MENSAGEM DE CONFIRMA√á√ÉO DA SARAH
                            setTimeout(() => {
                                chatHistory.push({
                                    role: 'assistant',
                                    content: '‚ú® **Comprovante recebido!** Agrade√ßo pelo pagamento. Vou verificar e em instantes come√ßaremos sua consulta espiritual! üîÆ'
                                });
                                renderChatHistory();
                            }, 1000);
                            
                            resetFileUpload();
                        } else {
                            uploadStatus.textContent = 'Erro no envio: ' + response.message;
                        }
                    } else {
                        uploadStatus.textContent = 'Erro no servidor';
                    }
                    sendFileBtn.disabled = false;
                });

                xhr.addEventListener('error', () => {
                    uploadStatus.textContent = 'Erro de conex√£o';
                    sendFileBtn.disabled = false;
                });

                xhr.open('POST', '/api/upload-comprovante');
                xhr.send(formData);

            } catch (error) {
                console.error('Erro no upload:', error);
                uploadStatus.textContent = 'Erro no envio';
                sendFileBtn.disabled = false;
            }
        });

        // Sugest√µes de Perguntas
        suggestionBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const question = btn.getAttribute('data-question');
                chatInput.value = question;
                chatInput.focus();
            });
        });

        // ‚úÖ ENVIAR MENSAGEM CORRIGIDO
        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const now = Date.now();
            if (now - lastMessageTime < 1000) return;
            
            const message = chatInput.value.trim();
            if (!message || isLoading) return;
            
            lastMessageTime = now;
            
            // ‚úÖ MOSTRAR √ÅREA DE UPLOAD SE FOR PEDIDO DE COMPROVANTE
            if (message.toLowerCase().includes('comprovante') || message.toLowerCase().includes('pix')) {
                uploadContainer.style.display = 'block';
            }
            
            // ‚úÖ ADICIONA MENSAGEM DO USU√ÅRIO AO HIST√ìRICO
            chatHistory.push({ role: 'user', content: message });
            renderChatHistory();
            chatInput.value = '';
            showTypingIndicator();
            
            try {
                isLoading = true;
                
                // ‚úÖ ENVIA HIST√ìRICO COMPLETO + SESSION ID
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: chatHistory,
                        sessionId: sessionId
                    })
                });

                if (!response.ok) throw new Error('Erro na resposta');
                const data = await response.json();
                
                removeTypingIndicator();
                
                // ‚úÖ ADICIONA RESPOSTA DA IA AO HIST√ìRICO
                chatHistory.push({ role: 'assistant', content: data.message });
                renderChatHistory();
                
            } catch (error) {
                console.error('Erro no chat:', error);
                removeTypingIndicator();
                const errorMessage = 'Desculpe, estou realinhando minhas energias c√≥smicas. Tente novamente ou use o WhatsApp. ‚ú®';
                chatHistory.push({ role: 'assistant', content: errorMessage });
                renderChatHistory();
            } finally {
                isLoading = false;
            }
        });

        // Fun√ß√µes Auxiliares
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message assistant';
            typingDiv.id = 'typing-indicator';
            typingDiv.innerHTML = `
                <div class="typing-indicator">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeTypingIndicator() {
            const typing = document.getElementById('typing-indicator');
            if (typing) typing.remove();
        }

        // Enviar com Enter
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                chatForm.dispatchEvent(new Event('submit'));
            }
        });

        // Focar no input ao abrir
        chatFloat.addEventListener('click', () => {
            setTimeout(() => chatInput.focus(), 300);
        });
    </script>
</body>
</html>